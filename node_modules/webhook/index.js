/*!
 * index.js
 * Copyright(c) 2012
 * Author: jifeng <wade428@163.com>
 */


var connect = require('connect');
var http = require('http');
var pack = require('./controllers/pack');
var sender = require('./controllers/sender');
var receiver = require('./controllers/receiver')

var Webhook = function (options) {
  this.options = options || {};
  this.pack = pack(this.options);
  this.sender = sender(this.options);
  this.receiver = receiver(this.options);
  var app = connect();
  app.use('/receiver', this.receiver.middleware());
  app.use('/pack', this.pack.middleware());
  app.use('/sender', this.sender.middleware());
  this.app = http.createServer(app);
}

Webhook.prototype.run = function(cb) {
  var options = this.options;
  var port = options.port;
  this.app.listen(port, cb)
};

module.exports = function (options) {
  return new Webhook(options);
}
