/*!
 * socket.js 
 * Copyright(c) 2012
 * Author: jifeng.zjd <jifeng.zjd@alibaba-inc.com>
 */

var http = require('http');

exports.post = function (sock, data, cb) {
  var req = http.request({socketPath: sock, method: 'POST'}, function(res) {
    res.setEncoding('utf8');
    var chunks = [];
    var size = 0;
    res.on('data', function (chunk) {
      chunks.push(chunk);
      size += chunk.length;
    });
    res.on('end', function () {
      var data = null;
      switch(chunks.length) {
        case 0: data = new Buffer(0);
          break;
        case 1: data = chunks[0];
          break;
        default:
          data = new Buffer(size);
          for (var i = 0, pos = 0, l = chunks.length; i < l; i++) {
            var chunk = chunks[i];
            chunk.copy(data, pos);
            pos += chunk.length;
          }
          break;
      }
      cb(null, data.toString())
    });
  });

  req.write(data);
  req.end();
}

